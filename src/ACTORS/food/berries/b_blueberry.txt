ACTOR BlueberryPlant : BerryPlant
{
	Radius 8
	Height 38

	States
	{
	Spawn:
		TNT1 A 0
		BPLN AAAAAAAAAA 1 A_FadeIn(0.1)
		TNT1 A 0 ACS_ExecuteAlways(963, 0, 0) //Set our TID to BERRY_PLANT_TID
	Resting:
		BPLN A -1
		//BPLN A 0 A_Jump(0,"ChangeToAnother")
		Wait
	
	ChangeToAnother:
	BPLN AAAAAAAAAA 1 A_FadeOut(0.1,false)
	Goto WaitForSpawn
	
	WaitForSpawn:
	TNT1 A 0
	TNT1 A 0 A_NoBlocking
	TNT1 A 0 A_UnsetSolid
	TNT1 A 0 A_SpawnItemEx("BerryRandomizer",0,0,0)
	TNT1 A 1
	Stop
	
	Active:
	BPLN A 0
	BPLN A 0
	BPLN A 0 A_JumpIf(args[0] == 1, "PostHarvest")
	Goto Harvest
	
	Harvest:
	BPLN A 0
	BPLN A 0 A_SetArg(0, 1)
	BPLN A 0 A_SpawnItemEx("BlueberryItem",random(-2,2),random(-2,2),random(5,25),random(-4,4),random(-4,4),random(5,12))
	BPLN A 0 A_Jump(96,"PostHarvest")
	BPLN A 1
	Loop
	
	PostHarvest:
	TNT1 A 0
	TNT1 A 0 A_NoBlocking
	TNT1 A 0 A_UnSetShootable
	TNT1 A 0 Thing_ChangeTID(0, 0) //Clear our TID so the 5% killoff doesn't send this plant into a weird state.
	BPLN B 30 
	BPLN BBBBBBBBBB 1 A_FadeOut(0.1, false)
	//TNT1 A 0 A_SpawnItemEx("BerryRandomizer",0,0,0)
	Stop
	}
}

ACTOR BlueberryItem : CustomInventory
{
  //+SHOOTABLE
  +NOBLOOD
  -SOLID
  +CANPASS
  +WINDTHRUST
  Tag "Blueberries"
  //HealthPickup.AutoUse 0
  +INVENTORY.INVBAR
  Inventory.MaxAmount 20
  Inventory.Icon "ZSEIA"
  Inventory.PickupMessage "Picked up a handful of ripe blueberries."
  Scale 0.5

  Health 30
  
  States
  {
	  Spawn:
	    ZSEP A 0
		ZSEP A 0 ACS_ExecuteAlways(953, 0, 0) //Set our TID to FOOD_TID so we can spoil
		ZSEP A 10500 //Disappear after 5 minutes
		Stop
	  Use:
		TNT1 A 0
		TNT1 A 0 A_GiveInventory("Health", 3)
		TNT1 A 0 A_TakeInventory("HungerLevel", 2)
		TNT1 A 0 A_PlaySound("eat/crunch")
		TNT1 A 0 ACS_ExecuteAlways(850, 0, 0) //Green screen flash - PLAYER.ACS
		stop

  }
}